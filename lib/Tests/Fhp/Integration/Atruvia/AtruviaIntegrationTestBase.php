<?php

namespace Tests\Fhp\Integration\Atruvia;

use Fhp\Model\SEPAAccount;
use Tests\Fhp\FinTsTestCase;

class AtruviaIntegrationTestBase extends FinTsTestCase
{
    public const TEST_URL = 'https://fints2.atruvia.de/cgi-bin/hbciservlet';

    public const TEST_PRODUCT_NAME = 'PRIVATE__________________';

    public const TEST_PRODUCT_VERSION = '2.0';

    public const TEST_USERNAME = 'PRIVATE_______';
    public const TEST_PIN = 'PRIVATE_';
    public const TEST_TAN_MODE = '946';
    public const TEST_KUNDENSYSTEM_ID = 'FAKEKUNDENSYSTE';

    // Anonymous dialog to fetch BPD (HKVVB, then HKEND).
    public const ANONYMOUS_INIT_REQUEST = "HNHBK:1:3+000000000145+300+0+1'HKIDN:2:2+280:11223344+9999999999+0+0'HKVVB:3:3+0+0+0+PRIVATE__________________+2.0'HKTAN:4:6+4+HKIDN'HNHBS:5:1+1'";
    public const ANONYMOUS_INIT_RESPONSE = "HNHBK:1:3+000000013003+300+FAKEDIALOGIDabc+1+FAKEDIALOGIDabc:1'HIRMG:2:2+3060::Bitte beachten Sie die enthaltenen Warnungen/Hinweise.+0100::Dialog beendet.'HIRMS:3:2:3+3050::BPD nicht mehr aktuell, aktuelle Version enthalten.+0020::Informationen fehlerfrei entgegengenommen.'HIBPA:4:3:3+936+280:11223344+PRIVATE_______________+1+1+300+1000'HIKOM:5:4:3+280:11223344+1+3:https?://fints2.atruvia.de/cgi-bin/hbciservlet+2:fints2.atruvia.de'HISHV:6:3:3+J+PIN:1+RDH:7:9:10'HIEKAS:7:5:3+1+1+1+J:J:N:3'HIKAZS:8:4:3+1+1+390:J'HIKAZS:9:5:3+1+1+390:J:N'HIKAZS:10:6:3+1+1+1+390:J:N'HIKAZS:11:7:3+1+1+1+390:J:N'HIPAES:12:1:3+1+1+1'HIPSPS:13:1:3+1+1+1'HIQTGS:14:1:3+1+1+1'HISALS:15:4:3+1+1'HISALS:16:7:3+1+1+1'HICSAS:17:1:3+1+1+1+1:400'HICSBS:18:1:3+1+1+1+N:N'HICSLS:19:1:3+1+1+1+J'HICSES:20:1:3+1+1+1+1:400'HICCSS:21:1:3+1+1+1'HISPAS:22:1:3+1+1+1+J:J:N:sepade?:xsd?:pain.008.001.02.xsd:sepade?:xsd?:pain.001.001.03.xsd:sepade?:xsd?:pain.001.001.03_GBIC_2.xsd:sepade?:xsd?:pain.008.001.02_GBIC_2.xsd:sepade?:xsd?:pain.001.001.03_GBIC_3.xsd:sepade?:xsd?:pain.008.001.02_GBIC_3.xsd:sepade?:xsd?:pain.001.001.09_GBIC_4.xsd:sepade?:xsd?:pain.008.001.08_GBIC_4.xsd'HICCMS:23:1:3+1+1+1+999:N:J'HIDSES:24:1:3+1+1+1+2:360:2:360'HIBSES:25:1:3+1+1+1+2:360:2:360'HIDMES:26:1:3+1+1+1+2:360:2:360:999:N:J'HIBMES:27:1:3+1+1+1+2:360:2:360:999:N:J'HICDBS:28:1:3+1+1+1+N'HICDLS:29:1:3+1+1+1+0:0:N:J'HIPPDS:30:2:3+1+1+1+1:Telekom:prepaid:N:::15;30;50:2:Vodafone:prepaid:N:::15;25;50;100:3:E-plus:prepaid:N:::15;20;30:4:O2:prepaid:N:::15;20;30:5:Congstar:prepaid:N:::15;30;50:6:Blau:prepaid:N:::15;20;30'HICDNS:31:1:3+1+1+1+0:1:3650:J:J:J:J:N:J:J:J:J:0102030612:01020304050607080910111213141516171819202122232425262728293099'HIDSBS:32:1:3+1+1+1+N:N:9999'HICUBS:33:1:3+1+1+1+N'HICUMS:34:1:3+1+1+1+ACCT;CASH;OTHR;'HICDES:35:1:3+1+1+1+4:1:3650:0102030612:01020304050607080910111213141516171819202122232425262728293099:01:12345'HIDSWS:36:1:3+1+1+1+J'HIECAS:37:1:3+1+1+1+J:N:N:urn?:iso?:std?:iso?:20022?:tech?:xsd?:camt.053.001.02:urn?:iso?:std?:iso?:20022?:tech?:xsd?:camt.053.001.08'GIVPUS:38:1:3+1+1+1+N'GIVPDS:39:1:3+1+1+1+1'HIAUBS:40:6:3+1+1+1+500'HIDBSS:41:1:3+1+1+1+N:N'HIBBSS:42:1:3+1+1+1+N:N'HIDMBS:43:1:3+1+1+1+N:N'HIBMBS:44:1:3+1+1+1+N:N'HICMBS:45:1:3+1+1+1+N:N'HICMES:46:1:3+1+1+1+1:400:999:J:J'HICMLS:47:1:3+1+1+1'HIWPDS:48:6:3+1+1+1+N:N:N'HIWDUS:49:5:3+1+1+1+365'HIBMES:50:2:3+1+1+1+0;1;110000:0;360:999:N:J'HIBSES:51:2:3+1+1+1+0;1;110000:0;360'HIDSES:52:2:3+1+1+1+0;0;1;130000:0;0;360'HIDMES:53:2:3+1+1+1+0;0;1;130000:0;0;360:999:N:J'HIKAUS:54:2:3+1+1+1'HIKIFS:55:7:3+1+1+1+N:N'HICAZS:56:1:3+1+1+1+390:N:N:urn?:iso?:std?:iso?:20022?:tech?:xsd?:camt.052.001.02:urn?:iso?:std?:iso?:20022?:tech?:xsd?:camt.052.001.08'HIBAZS:57:1:3+1+1+1+N:N:N'HIZDFS:58:1:3+1+1+1+99'HIDVKS:59:2:3+1+1+1+N:J'HIDDBS:60:1:3+1+1+1+N:sepade?:xsd?:pain.008.003.02.xsd:sepade?:xsd?:pain.008.001.02.xsd:sepade?:xsd?:pain.008.001.02_GBIC_2.xsd'HIDDES:61:1:3+1+1+1+CORE:2:360:0102030612:01020304050607080910111213141516171819202122232425262728293099:01:12345::sepade?:xsd?:pain.008.001.02.xsd:sepade?:xsd?:pain.008.001.02_GBIC_2.xsd'HIDDLS:62:1:3+1+1+1+0:3650:N:J:sepade?:xsd?:pain.008.003.02.xsd:sepade?:xsd?:pain.008.001.02.xsd:sepade?:xsd?:pain.008.001.02_GBIC_2.xsd'HIDDNS:63:1:3+1+1+1+1:2:3650:J:J:J:J:N:J:J:J:N:0102030612:01020304050607080910111213141516171819202122232425262728293099:01:12345::sepade?:xsd?:pain.008.003.02.xsd:sepade?:xsd?:pain.008.001.02.xsd:sepade?:xsd?:pain.008.001.02_GBIC_2.xsd'HIKAAS:64:1:3+1+1+1+N:J:J:J:4;PDF;1'HIPOFS:65:1:3+1+1+1+J:N:100;Kundenmitteilung'HIIPSS:66:1:3+1+1+1+35:sepade?:xsd?:pain.001.001.03_GBIC_2.xsd:sepade?:xsd?:pain.001.001.03_GBIC_3.xsd:sepade?:xsd?:pain.001.001.09_GBIC_4.xsd'HIIPZS:67:1:3+1+1+1+:sepade?:xsd?:pain.001.001.03_GBIC_2.xsd:sepade?:xsd?:pain.001.001.03_GBIC_3.xsd:sepade?:xsd?:pain.001.001.09_GBIC_4.xsd'HIBMLS:68:1:3+1+1+1'HIBSAS:69:1:3+1+1+1+2:360:2:360'HIBSLS:70:1:3+1+1+1+J'HIDMLS:71:1:3+1+1+1'HIDSAS:72:1:3+1+1+1+2:360:2:360'HIDSLS:73:1:3+1+1+1+J'HIAUBS:74:9:3+1+1+1+2006:500:15000,'HIZDAS:75:1:3+1+1+1+99'HIZDLS:76:1:3+1+1+1'HIVPAS:77:1:3+1+1+1'HIVPPS:78:1:3+1+1+1+999:J:V:J:J:urn?:iso?:std?:iso?:20022?:tech?:xsd?:pain.002.001.10:HKCCS:HKCDE:HKCDN:HKCSE:HKCSA:HKIPZ:HKCCM:HKCME:HKZDF:HKZDA'HIVOOS:79:1:3+1+1+1+J:HKCCM:HKCME:HKZDF:HKZDA'HITANS:80:6:3+1+1+1+J:N:0:942:2:MTAN2:mobileTAN::mobile TAN:6:1:SMS:2048:J:1:N:0:2:N:J:00:0:N:1:944:2:SECUREGO:mobileTAN::SecureGo:6:1:TAN:2048:J:1:N:0:2:N:J:00:0:N:1:962:2:HHD1.4:HHD:1.4:Smart-TAN plus manuell:6:1:Challenge:2048:J:1:N:0:2:N:J:00:0:N:1:972:2:HHD1.4OPT:HHDOPT1:1.4:Smart-TAN plus optisch / USB:6:1:Challenge:2048:J:1:N:0:2:N:J:00:0:N:1:982:2:MS1.0.0:::Smart-TAN photo:6:1:Challenge:2048:J:1:N:0:2:N:J:00:0:N:1'HITANS:81:7:3+1+1+1+N:N:0:946:2:DECOUPLED:Decoupled::SecureGo plus (Direktfreigabe):::TAN:2048:J:1:N:0:2:N:J:00:0:N:1:150:2:2:J:J'HIPINS:82:1:3+1+1+0+5:20:6:Sparda-NetKey oder Alias::HKTAN:N:HKKAZ:J:HKSAL:N:HKEKA:N:HKPAE:J:HKPSP:N:HKQTG:N:HKCSA:J:HKCSB:N:HKCSL:J:HKCSE:J:HKCCS:J:HKSPA:N:HKCCM:J:HKDSE:J:HKBSE:J:HKDME:J:HKBME:J:HKCDB:N:HKCDL:J:HKPPD:J:HKCDN:J:HKDSB:N:HKCUB:N:HKCUM:J:HKCDE:J:HKDSW:J:HKECA:N:HKAUB:J:HKDBS:N:HKBBS:N:HKDMB:N:HKBMB:N:HKCMB:N:HKCME:J:HKCML:J:HKWPD:N:HKWDU:N:HKKAU:N:HKKIF:N:HKCAZ:J:HKBAZ:N:HKZDF:J:HKDVK:N:HKDDB:N:HKDDE:J:HKDDL:J:HKDDN:J:HKKAA:N:HKPOF:N:HKIPS:N:HKIPZ:J:HKBML:J:HKBSA:J:HKBSL:J:HKDML:J:HKDSA:J:HKDSL:J:HKZDA:J:HKZDL:N:GKVPU:N:GKVPD:N'HIAZSS:83:1:3+1+1+1+1:N:::::::::::HKCUM;1;0;1;811:HKBSE;1;0;1;811:HKCCS;1;0;1;811:HKQTG;1;0;1;811:HKDSL;1;0;1;811:HKDML;1;0;1;811:HKCCM;1;0;1;811:HKZDA;1;0;1;811:HKKIF;7;0;1;811:HKCSA;1;0;1;811:HKBAZ;1;0;1;811:HKZDF;1;0;1;811:HKIPS;1;0;1;811:HKKAZ;6;0;1;811:HKKAZ;5;0;1;811:HKSAL;4;0;1;811:HKCUB;1;0;1;811:HKWDU;5;0;1;811:HKKAU;2;0;1;811:HKBSL;1;0;1;811:HKAUB;9;0;1;811:HKDDE;1;0;1;811:HKCDL;1;0;1;811:HKBMB;1;0;1;811:HKBML;1;0;1;811:HKCSB;1;0;1;811:HKCDN;1;0;1;811:HKDSW;1;0;1;811:HKCAZ;1;0;1;811:HKDSE;1;0;1;811:HKKAA;1;0;1;811:HKAUB;6;0;1;811:HKCDE;1;0;1;811:HKBBS;1;0;1;811:HKBME;2;0;1;811:HKDMB;1;0;1;811:GKVPU;1;0;1;811:HKPPD;2;0;1;811:HKCME;1;0;1;811:HKDSE;2;0;1;811:HKDDL;1;0;1;811:HKDBS;1;0;1;811:HKIPZ;1;0;1;811:HKDME;2;0;1;811:HKDSB;1;0;1;811:HKCML;1;0;1;811:HKDDN;1;0;1;811:HKEKA;5;0;1;811:HKBSE;2;0;1;811:HKBME;1;0;1;811:HKCSE;1;0;1;811:HKSPA;1;0;1;811:GKVPD;1;0;1;811:HKCDB;1;0;1;811:HKDDB;1;0;1;811:HKBSA;1;0;1;811:HKIDN;2;0;1;811:HKECA;1;0;1;811:HKDVK;2;0;1;811:HKDSA;1;0;1;811:HKKAZ;7;0;1;811:HKDME;1;0;1;811:HKPOF;1;0;1;811:HKKAZ;4;0;1;811:HKCSL;1;0;1;811:HKWPD;6;0;1;811:HKSAL;7;0;1;811:HKCMB;1;0;1;811'HIVISS:84:1:3+1+1+1+1;L;;Bankauftrag;;;;1;L;;allgemein;;;;2;L;;Legitimation;;;;2;L;;Benutzerkennung;;;;3;L;;Version;;;;4;L;;?berweisung;;;;5;L;;Umbuchung;;;;6;L;;Umbuchung;;;;6;L;;terminiert;;;;7;L;;?berweisung;;;;7;L;;Referenzkonto;;;;8;L;;?berweisung;;;;8;L;;SEPA/EU;;;;9;L;;?berweisung;;;;9;L;;Inland;;;;10;L;;?berweisung;;;;10;L;;Ausland;;;;11;L;;Sammel-;;;;11;L;;?berweisung;;;;12;L;;Sammel?berw.;;;;12;L;;SEPA;;;;13;L;;Sammel?berw.;;;;13;L;;Ausland;;;;14;L;;Lastschrift;;;;15;L;;R?ckgabe;;;;15;L;;Lastschrift;;;;16;L;;Lastschrift;;;;16;L;;SEPA;;;;17;L;;Lastschrift;;;;17;L;;Ausland;;;;18;L;;Sammel-;;;;18;L;;Lastschrift;;;;19;L;;Sammellasts.;;;;19;L;;SEPA;;;;20;L;;Sammellasts.;;;;20;L;;Ausland;;;;21;L;;Termin-;;;;21;L;;Überweisung;;;;22;L;;Termin?berw.;;;;22;L;;SEPA;;;;23;L;;Termin?berw.;;;;23;L;;Ausland;;;;24;L;;Termin?berw.;;;;24;L;;Sammel Inl.;;;;25;L;;Terminüberw.;;;;25;L;;Sammel SEPA;;;;26;L;;Termin?berw.;;;;26;L;;Sammel Ausl.;;;;27;L;;Terminlasts.;;;;27;L;;Inland;;;;28;L;;Terminlasts.;;;;28;L;;SEPA;;;;29;L;;Terminlasts.;;;;29;L;;Ausland;;;;30;L;;Terminlasts.;;;;30;L;;Sammel Inl.;;;;31;L;;Terminlasts.;;;;31;L;;Sammel SEPA;;;;32;L;;Terminlasts.;;;;32;L;;Sammel Ausl.;;;;33;L;;Dauer?berw.;;;;33;L;;Inland;;;;34;L;;Dauer-;;;;34;L;;?berweisung;;;;35;L;;Dauer?berw.;;;;35;L;;Ausland;;;;36;L;;Dauerlasts.;;;;36;L;;Inland;;;;37;L;;Dauerlasts.;;;;37;L;;SEPA;;;;38;L;;Bestand;;;;38;L;;abfragen;;;;39;L;;L?schen;;;;39;L;;Auftrag;;;;40;L;;Aussetzen;;;;40;L;;Auftrag;;;;41;L;;Aussetzen;;;;41;L;;Auftrag;;;;42;L;;?ndern;;;;42;L;;Auftrag;;;;43;L;;ändern;;;;43;L;;Auftrag;;;;44;L;;Freigabe;;;;44;L;;?berw. DTAUS;;;;45;L;;Freigabe;;;;45;L;;Lasts. DTAUS;;;;46;L;;Freigabe;;;;46;L;;überw. DTAZV;;;;47;L;;Freigabe;;;;47;L;;überw. SEPA;;;;48;L;;Freigabe;;;;48;L;;Lasts. SEPA;;;;49;L;;Freigabe;;;;49;L;;DSRZ-Dateien;;;;50;L;;Kontoauszug;;;;50;L;;u. Quittung;;;;51;L;;Kontoauszug;;;;51;L;;an/abmelden;;;;52;L;;Postfach;;;;52;L;;an/abmelden;;;;53;L;;Postkorb;;;;54;L;;Datentresor;;;;55;L;;Wertpapier;;;;55;L;;Kauf;;;;56;L;;Wertpapier;;;;56;L;;Verkauf;;;;57;L;;Wertpapier;;;;57;L;;Geschäft;;;;58;L;;Anlage;;;;58;L;;Abschluss;;;;59;L;;Kredit;;;;59;L;;Abschluss;;;;60;L;;Produkt;;;;60;L;;Kauf;;;;61;L;;Versicherung;;;;61;L;;Abschluss;;;;62;L;;Service;;;;62;L;;Funktionen;;;;63;L;;TAN-Medien;;;;63;L;;Management;;;;64;L;;Mobiltelefon;;;;64;L;;laden;;;;65;L;;GeldKarte;;;;65;L;;laden;;;;66;L;;Zahlung;;;;66;L;;Internet;;;;67;L;;Geldtransfer;;;;67;L;;Internet;;;;68;L;;Freistellung;;;;69;L;;Adresse;;;;69;L;;ändern;;;;70;L;;Wertpapier;;;;70;L;;Kauf;;;;71;L;;Wertpapier;;;;71;L;;Verkauf;;;;72;L;;Wertpapier;;;;72;L;;Geschäft;;;;73;L;;Eigene;;;;73;L;;IBAN;;;;74;L;;IBAN;;;;74;L;;Empfänger;;;;75;L;;IBAN;;;;75;L;;Zahler;;;;76;L;;IBAN;;;;76;L;;Absender;;;;77;L;;Kunden;;;;77;L;;Nummer;;;;78;L;;Vertrags-;;;;78;L;;Kennung;;;;79;L;;Eigene;;;;79;L;;IBAN;;;;80;L;;Name;;;;81;L;;Auftrags-;;;;81;L;;Identifikation;;;;82;L;;H?ndler;;;;82;L;;Name;;;;83;L;;Karten-;;;;83;L;;nummer;;;;84;L;;TAN;;;;84;L;;Medium;;;;85;L;;Summe nur;;;;85;L;;Vorkommastellen;;;;86;L;;Freistellung;;;;86;L;;ändern;;;;87;L;;Überweisung;;;;87;L;;Instant Payment;;;;88;L;;Dauerüberw.;;;;88;L;;Instant Payment;;;;89;L;;Terminüberw.;;;;89;L;;Instant Payment;;;;90;L;;Echtzeit.;;;;90;L;;Sammelüberweis.;;;;91;L;;Adresse?:;;;;91;L;16;#;;;;92;L;;Angebots-Nr?:;;;;92;R;16;#;;;;93;L;;Anzahl?:;;;;93;R;16;#;;;;94;L;;Auftrags-ID?:;;;;94;L;16;#;;;;95;L;;Aut.Merkmal?:;;;;95;L;16;#;;;;96;L;;Bankdaten?:;;;;96;L;16;#;;;;97;L;;Betrag?:;;;;97;R;16;#;;;;98;L;;BIC Empf.?:;;;;98;L;16;#;;;;99;L;;BLZ Abs.?:;;;;99;R;16;#;;;;100;L;;BLZ Empfänger;;;;100;R;16;#;;;;101;L;;BLZ Karte?:;;;;101;R;16;#;;;;102;L;;BLZ Zahler?:;;;;102;R;16;#;;;;103;L;;Eigene BLZ?:;;;;103;R;16;#;;;;104;L;;Eigenes Kto?:;;;;104;R;16;#;;;;105;L;;Geburtsdatum;;;;105;L;16;#;;;;106;L;;Händlername?:;;;;106;L;16;#;;;;107;L;;ISIN?:;;;;107;L;16;#;;;;108;L;;Kartennummer;;;;108;R;16;#;;;;109;L;;Konto Abs.?:;;;;109;R;16;#;;;;110;L;;Konto Empfänger;;;;110;R;16;#;;;;111;L;;Konto Zahler;;;;111;R;16;#;;;;112;L;;Kreditkarte?:;;;;112;R;16;#;;;;113;L;;Limit?:;;;;113;R;16;#;;;;114;L;;Menge?:;;;;114;R;16;#;;;;115;L;;Mobilfunknummer;;;;115;R;16;#;;;;116;L;;Name Empf.?:;;;;116;L;16;#;;;;117;L;;Postleitzahl;;;;117;R;16;#;;;;118;L;;Rate?:;;;;118;R;16;#;;;;119;L;;Referenzkto?:;;;;119;R;16;#;;;;120;L;;Referenzzahl;;;;120;R;16;#;;;;121;L;;Stücke/Nom.?:;;;;121;R;16;#;;;;122;L;;TAN-Medium;;;;122;L;16;#;;;;123;L;;Termin?:;;;;123;L;16;#;;;;124;L;;Vertrag.Kenn;;;;124;L;16;#;;;;125;L;;WP-Kenn-Nr?:;;;;125;R;16;#;;;;126;L;;Kunden-Nr.;;;;126;R;16;#;;;;127;L;;Summe;;;;127;R;16;#;;;;128;L;32;#;;;;129;R;32;#;;;;130;L;16;#;;;;131;R;16;#;;;:HKBME;1;811;18;;;73;;;128;4;IBAN.1;97;4;CtrlSum.1;93;4;NbOfTxs.1:HKBML;1;811;39;;;79;;;128;1;3,1;97;1;7,1;81;;;128;1;2:HKBSA;1;811;42;;;75;;;128;4;IBAN.2;97;4;CtrlSum.1:HKBSE;1;811;14;;;75;;;128;4;IBAN.2;97;4;CtrlSum.1:HKBSL;1;811;39;;;79;;;128;4;IBAN.1;97;4;CtrlSum.1;81;;;128;4;MsgId.1:HKCCM;1;811;11;;;79;;;128;4;IBAN.1;97;4;CtrlSum.1;93;4;NbOfTxs.1:HKCCS;1;811;4;;;74;;;128;4;IBAN.2;97;4;CtrlSum.1:HKCDE;1;811;34;;;74;;;128;4;IBAN.2;97;4;CtrlSum.1:HKCDL;1;811;39;;;73;;;128;4;IBAN.1;97;4;CtrlSum.1:HKCDN;1;811;42;;;74;;;128;4;IBAN.2;97;4;CtrlSum.1:HKCME;1;811;25;;;79;;;128;1;2,1;97;4;CtrlSum.1;93;4;NbOfTxs.1:HKCML;1;811;39;;;79;;;128;1;3,1;97;1;7,1:HKCSA;1;811;42;;;74;;;128;4;IBAN.2;97;4;CtrlSum.1:HKCSE;1;811;21;;;74;;;128;4;IBAN.2;97;4;CtrlSum.1:HKCSL;1;811;39;;;79;;;128;4;IBAN.1;97;4;CtrlSum.1:HKCUM;1;811;5;;;74;;;128;4;IBAN.2;97;4;CtrlSum.1:HKDDE;1;811;37;;;75;;;128;4;IBAN.2;97;4;CtrlSum.1:HKDDL;1;811;39;;;75;;;128;4;IBAN.2;97;4;CtrlSum.1;81;;;128;4;MsgId.1:HKDDN;1;811;42;;;75;;;128;4;IBAN.2;97;4;CtrlSum.1:HKDME;1;811;18;;;73;;;128;4;IBAN.1;97;4;CtrlSum.1;93;4;NbOfTxs.1:HKDML;1;811;39;;;79;;;128;1;3,1;97;1;7,1;81;;;128;1;2:HKDSA;1;811;42;;;75;;;128;4;IBAN.2;97;4;CtrlSum.1:HKDSE;1;811;14;;;75;;;128;4;IBAN.2;97;4;CtrlSum.1:HKDSL;1;811;39;;;79;;;128;4;IBAN.1;97;4;CtrlSum.1;81;;;128;4;MsgId.1:HKDSW;1;811;15;;;73;;;128;1;2,1;97;1;4,1:HKPPD;2;811;64;;;79;;;128;1;2,1;97;1;5,1:HKAUB;6;811;10;;;85;;;131;3;Z.3:HKDSE;2;811;14;;;75;;;128;4;IBAN.2;97;4;CtrlSum.1:HKBSE;2;811;14;;;75;;;128;4;IBAN.2;97;4;CtrlSum.1:HKDME;2;811;18;;;73;;;128;4;IBAN.1;97;4;CtrlSum.1;93;4;NbOfTxs.1:HKBME;2;811;18;;;73;;;128;4;IBAN.1;97;4;CtrlSum.1;93;4;NbOfTxs.1:HKAUB;9;811;10;;;85;;;131;3;Z.3:HKZDF;1;811;49;;;79;;;128;1;2,1;81;;;128;1;3;93;1;4,5:HKIPZ;1;811;87;;;74;;;128;4;IBAN.2;97;4;CtrlSum.1:HKZDA;1;811;49;;;79;;;128;1;2,1;81;;;128;1;3;93;1;4,5'HITAN:85:6:4+4++noref+nochallenge'HNHBS:86:1+1'";
    public const ANONYMOUS_END_REQUEST = "HNHBK:1:3+000000000083+300+FAKEDIALOGIDabc+2'HKEND:2:1+FAKEDIALOGIDabc'HNHBS:3:1+2'";
    public const ANONYMOUS_END_RESPONSE = "HNHBK:1:3+000000000141+300+FAKEDIALOGIDabc+2+FAKEDIALOGIDabc:2'HIRMG:2:2+0010::Nachricht entgegengenommen.+0100::Dialog beendet.'HNHBS:3:1+2'";

    public const SYNC_REQUEST = "HNHBK:1:3+000000000404+300+0+1'HNVSK:998:3+PIN:1+998+1+1::0+1:20190102:030405+2:2:13:@8@00000000:5:1+280:11223344:PRIVATE_______:V:0:0+0'HNVSD:999:1+@237@HNSHK:2:4+PIN:1+999+9999999+1+1+1::0+1+1:20190102:030405+1:999:1+6:10:19+280:11223344:PRIVATE_______:S:0:0'HKIDN:3:2+280:11223344+PRIVATE_______+0+1'HKVVB:4:3+936+0+0+PRIVATE__________________+2.0'HKSYN:5:3+0'HNSHA:6:2+9999999++PRIVATE_''HNHBS:7:1+1'";
    public const SYNC_RESPONSE = "HNHBK:1:3+000000000599+300+FAKEDIALOGIDabc+1+FAKEDIALOGIDabc:1'HNVSK:998:3+PIN:1+998+1+2::0+1:20190102:030405+2:2:13:@8@00000000:5:1+280:11223344:PRIVATE_______:V:0:0+0'HNVSD:999:1+@400@HNSHK:2:4+PIN:1+999+9999999+1+1+2::0+1+1:20190102:030405+1:999:1+6:10:19+280:11223344:PRIVATE_______:S:0:0'HIRMG:3:2+3060::Bitte beachten Sie die enthaltenen Warnungen/Hinweise.'HIRMS:4:2:5+0020::Auftrag ausgeführt.'HIRMS:5:2:4+3920::Zugelassene TAN-Verfahren für den Benutzer:946+0901::*PIN gültig.+0020::*Dialoginitialisierung erfolgreich'HISYN:6:4:5+FAKEKUNDENSYSTEMIDabcdefghij'HNSHA:7:2+9999999''HNHBS:8:1+1'";

    public const SYNC_END_REQUEST = "HNHBK:1:3+000000000396+300+FAKEDIALOGIDabc+2'HNVSK:998:3+PIN:1+998+1+1::FAKEKUNDENSYSTEMIDabcdefghij+1:20190102:030405+2:2:13:@8@00000000:5:1+280:11223344:PRIVATE_______:V:0:0+0'HNVSD:999:1+@188@HNSHK:2:4+PIN:1+999+9999999+1+1+1::FAKEKUNDENSYSTEMIDabcdefghij+1+1:20190102:030405+1:999:1+6:10:19+280:11223344:PRIVATE_______:S:0:0'HKEND:3:1+FAKEDIALOGIDabc'HNSHA:4:2+9999999++PRIVATE_''HNHBS:5:1+2'";
    public const SYNC_END_RESPONSE = "HNHBK:1:3+000000000412+300+FAKEKUNDENSYSTE+2+FAKEKUNDENSYSTE:2'HNVSK:998:3+PIN:1+998+1+2::FAKEDIALOGIDabcdefghijklmnop+1+2:2:13:@8@00000000:5:1+280:11223344:PRIVATE_______:V:0:0+0'HNVSD:999:1+@202@HNSHK:2:4+PIN:1+999+6934077+1+1+2::FAKEDIALOGIDabcdefghijklmnop+1+1+1:999:1+6:10:19+280:11223344:PRIVATE_______:S:0:0'HIRMG:3:2+0010::Nachricht entgegengenommen.+0100::Dialog beendet.'HNSHA:4:2+9999999''HNHBS:5:1+2'";

    // Dialog initialization for main dialog (HKVVB). As this is the first time we use strong authentication, we get the UPD.
    // Also, using strong (=regular) authentication allows us to leave off the HNHBK/HNVSD wrapper here and let FinTsTestCase handle it.
    public const INIT_REQUEST = "HKIDN:3:2+280:11223344+PRIVATE_______+FAKEKUNDENSYSTEMIDabcdefghij+1'HKVVB:4:3+936+0+0+PRIVATE__________________+2.0'HKTAN:5:7+4+HKIDN'";

    public const INIT_RESPONSE = "HIRMG:3:2+3060::Bitte beachten Sie die enthaltenen Warnungen/Hinweise.'HIRMS:4:2:4+3050::UPD nicht mehr aktuell, aktuelle Version enthalten.+3920::Zugelassene TAN-Verfahren für den Benutzer:946+0901::*PIN g?ltig.+0020::*Dialoginitialisierung erfolgreich'HIRMS:5:2:5+3076::Starke Kundenauthentifizierung nicht notwendig.'HIUPA:6:4:4+PRIVATE_______+584+0'" .
        "HIUPD:7:6:4+PRIVAT::280:11223344+DE00112233440000000000+PRIVATE_______+1+EUR+PRIVATE__________________++Kontokorrent++HKSAK:1+HKISA:1+HKSSP:1+HKCAZ:1+HKEKA:1+HKKAU:1+HKCDB:1+HKPSP:1+HKCSL:1+HKCDL:1+HKPAE:1+HKDVK:1+HKPPD:1+HKCSA:1+HKCDN:1+HKBMB:1+HKBBS:1+HKDMB:1+HKDBS:1+HKCSB:1+HKCUB:1+HKKAA:1+HKPOF:1+HKQTG:1+HKSPA:1+HKDSB:1+HKIPZ:1+HKIPS:1+HKCUM:1+HKCCS:1+HKCDE:1+HKCSE:1+HKDSW:1+HKSAL:1+HKKIF:1+HKKAZ:1+HKAUB:1+GKVPU:1+GKVPD:1+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++{\"umsltzt\"?:\"2025-10-10-10.32.13.000636\"}'" .
        "HITAN:8:7:5+4++noref+nochallenge'"
    ;

    // Dialog end for main dialog (HKEND).
    public const FINAL_END_REQUEST = "HKEND:3:1+FAKEDIALOGIDabcdefghijklmnopqr'";
    public const FINAL_END_RESPONSE = "HIRMG:3:2+0010::Nachricht entgegengenommen.+0100::Dialog beendet.'";

    /**
     * Executes dialog synchronization and initialization, so that BPD and UPD are filled.
     * @throws \Throwable
     */
    protected function InitAnonymous()
    {
        $this->expectMessage(static::ANONYMOUS_INIT_REQUEST, mb_convert_encoding(static::ANONYMOUS_INIT_RESPONSE, 'ISO-8859-1', 'UTF-8'));
        $this->expectMessage(static::ANONYMOUS_END_REQUEST, mb_convert_encoding(static::ANONYMOUS_END_RESPONSE, 'ISO-8859-1', 'UTF-8'));

        $this->fints->getBpd();
    }

    /**
     * Executes dialog synchronization and initialization, so that BPD and UPD are filled.
     * @throws \Throwable
     */
    protected function initDialog()
    {
        // We already know the TAN mode, so it will only fetch the BPD (anonymously) to verify it.
        $this->expectMessage(static::ANONYMOUS_INIT_REQUEST, mb_convert_encoding(static::ANONYMOUS_INIT_RESPONSE, 'ISO-8859-1', 'UTF-8'));
        $this->expectMessage(static::ANONYMOUS_END_REQUEST, mb_convert_encoding(static::ANONYMOUS_END_RESPONSE, 'ISO-8859-1', 'UTF-8'));

        // Then when we initialize a dialog, it's going to request a Kundensystem-ID and UPD.
        $this->expectMessage(static::SYNC_REQUEST, mb_convert_encoding(static::SYNC_RESPONSE, 'ISO-8859-1', 'UTF-8'));
        $this->expectMessage(static::SYNC_END_REQUEST, mb_convert_encoding(static::SYNC_END_RESPONSE, 'ISO-8859-1', 'UTF-8'));

        // And finally it can initialize the main dialog.
        $this->expectMessage(static::INIT_REQUEST, mb_convert_encoding(static::INIT_RESPONSE, 'ISO-8859-1', 'UTF-8'));

        $this->fints->selectTanMode(intval(static::TEST_TAN_MODE));
        $login = $this->fints->login();
        $login->ensureDone(); // No TAN required upon login.*/
        $this->assertAllMessagesSeen();
    }

    protected function getTestAccount(): SEPAAccount
    {
        $sepaAccount = new SEPAAccount();
        $sepaAccount->setIban('DE00ABCDEFGH1234567890');
        $sepaAccount->setBic('ABCDEFGHIJK');
        $sepaAccount->setAccountNumber('1234567890');
        $sepaAccount->setBlz(self::TEST_BANK_CODE);
        return $sepaAccount;
    }
}
